---
import BaseLayout from '../layouts/BaseLayout.astro';
import Breadcrumbs from '../components/global/Breadcrumbs.astro';
import resourcesData from '../data/resources.json';
import modulesMeta from '../data/modules-meta.json';

function getModuleTitle(moduleId: string) {
  const mod = modulesMeta.find((m: any) => m.id === moduleId);
  return mod ? `Q${mod.questionNumber}: ${mod.title}` : moduleId;
}

function getModuleSlug(moduleId: string) {
  const mod = modulesMeta.find((m: any) => m.id === moduleId);
  return mod ? mod.slug : moduleId;
}

const typeIcons: Record<string, string> = {
  article: 'Article',
  documentation: 'Docs',
  tool: 'Tool',
  resource: 'Resource',
  newsletter: 'Newsletter',
};

const typeColors: Record<string, string> = {
  article: 'bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-300',
  documentation: 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300',
  tool: 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300',
  resource: 'bg-violet-100 text-violet-800 dark:bg-violet-900/30 dark:text-violet-300',
  newsletter: 'bg-teal-100 text-teal-800 dark:bg-teal-900/30 dark:text-teal-300',
};

const totalResources = resourcesData.categories.reduce((sum, cat) => sum + cat.resources.length, 0);
---

<BaseLayout title="Resources" description="Curated links and tools for front-end developers.">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <Breadcrumbs items={[
      { label: 'Home', href: import.meta.env.BASE_URL },
      { label: 'Resources', href: '#', current: true },
    ]} />
    <h1 class="text-3xl sm:text-4xl font-bold mb-4">Resources</h1>
    <p class="text-lg text-gray-600 dark:text-gray-400 mb-4">
      {totalResources} curated links across {resourcesData.categories.length} categories to support your learning.
    </p>
    <p class="text-sm text-gray-500 dark:text-gray-400 mb-8">
      All resources are free and link to official documentation, trusted community sites, and practical tools.
    </p>

    <!-- Category navigation -->
    <nav class="flex flex-wrap gap-2 mb-10" aria-label="Resource categories">
      {resourcesData.categories.map(cat => (
        <a
          href={`#${cat.id}`}
          class="text-sm px-3 py-1.5 rounded-full border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400 hover:bg-primary-50 dark:hover:bg-primary-900/30 hover:text-primary-600 dark:hover:text-primary-400 hover:border-primary-300 dark:hover:border-primary-700 transition-colors"
        >
          {cat.title}
        </a>
      ))}
    </nav>

    <!-- Resource categories -->
    <div class="space-y-12">
      {resourcesData.categories.map(cat => (
        <section id={cat.id}>
          <h2 class="text-xl font-bold mb-1 text-primary-600 dark:text-primary-400">
            {cat.title}
          </h2>
          <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
            {cat.resources.length} resource{cat.resources.length !== 1 ? 's' : ''}
          </p>
          <div class="grid gap-4 sm:grid-cols-2">
            {cat.resources.map(resource => (
              <a
                href={resource.url}
                target="_blank"
                rel="noopener noreferrer"
                class="group block p-4 rounded-lg border border-gray-200 dark:border-gray-800 hover:border-primary-300 dark:hover:border-primary-700 hover:shadow-md transition-all"
              >
                <div class="flex items-start justify-between gap-2 mb-2">
                  <h3 class="font-semibold text-gray-900 dark:text-gray-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors">
                    {resource.title}
                  </h3>
                  <span class={`text-xs px-2 py-0.5 rounded-full font-medium flex-shrink-0 ${typeColors[resource.type] || 'bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400'}`}>
                    {typeIcons[resource.type] || resource.type}
                  </span>
                </div>
                <p class="text-sm text-gray-600 dark:text-gray-400 leading-relaxed mb-3">
                  {resource.description}
                </p>
                <div class="flex items-center justify-between">
                  {resource.relatedModules.length > 0 ? (
                    <div class="flex items-center gap-1.5 flex-wrap">
                      <span class="text-xs text-gray-400 dark:text-gray-500">Modules:</span>
                      {resource.relatedModules.map((modId: string) => (
                        <span class="text-xs text-gray-500 dark:text-gray-400">
                          Q{modulesMeta.find((m: any) => m.id === modId)?.questionNumber || '?'}
                        </span>
                      ))}
                    </div>
                  ) : (
                    <span />
                  )}
                  <svg class="w-4 h-4 text-gray-400 dark:text-gray-500 group-hover:text-primary-500 transition-colors flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </div>
              </a>
            ))}
          </div>
        </section>
      ))}
    </div>
  </div>
</BaseLayout>
