---
import { Code } from 'astro:components';

interface Props {
  title: string;
  language: string;
  code: string;
  description: string;
}

const { title, language, code, description } = Astro.props;
---

<div class="my-8 rounded-xl border border-gray-200 dark:border-gray-800 overflow-hidden shadow-sm">
  <div class="flex items-center justify-between px-5 py-3 bg-gray-50 dark:bg-gray-900/80 border-b border-gray-200 dark:border-gray-800">
    <div class="flex items-center gap-3">
      <div class="flex gap-1.5">
        <span class="w-3 h-3 rounded-full bg-red-400/60"></span>
        <span class="w-3 h-3 rounded-full bg-yellow-400/60"></span>
        <span class="w-3 h-3 rounded-full bg-green-400/60"></span>
      </div>
      <span class="text-sm font-medium text-gray-600 dark:text-gray-400">{title}</span>
    </div>
    <button
      class="copy-btn text-xs px-3 py-1.5 rounded-md bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium"
      data-code={code}
      aria-label={`Copy code: ${title}`}
    >
      Copy
    </button>
  </div>
  <div class="code-block-body overflow-x-auto bg-white dark:bg-gray-950">
    <Code code={code.trim()} lang={language} themes={{ light: 'github-light', dark: 'github-dark' }} />
  </div>
  <div class="px-5 py-3.5 text-sm text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-900/80 border-t border-gray-200 dark:border-gray-800 leading-relaxed">
    {description}
  </div>
</div>

<script>
  document.querySelectorAll('.copy-btn').forEach((btn) => {
    btn.addEventListener('click', async () => {
      const code = (btn as HTMLElement).dataset.code;
      if (!code) return;
      try {
        await navigator.clipboard.writeText(code);
        const original = btn.textContent;
        btn.textContent = 'Copied!';
        setTimeout(() => { btn.textContent = original; }, 2000);
      } catch {
        btn.textContent = 'Failed';
        setTimeout(() => { btn.textContent = 'Copy'; }, 2000);
      }
    });
  });
</script>
